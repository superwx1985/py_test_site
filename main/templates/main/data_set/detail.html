{% extends 'main/detail_base.html' %}
{% load static %}
{% block title %}
    {% if form.initial.name %}
        数据组{{ block.super }} | {{ form.initial.name }}
    {% else %}
        新数据组{{ block.super }}
    {% endif %}
{% endblock %}

{% block style %}
    <style media='screen'>
        td[contenteditable="true"]:focus {
            outline: 2px solid #4CAF50;
        }

        td.no-lef-right-padding {
            padding-left: 0;
            padding-right: 0;
        }

        td.vertical-align-middle {
            vertical-align: middle;
            text-align: center;
        }

    </style>
    <link rel="stylesheet" href="{% static 'handsontable/handsontable.full.min.css' %}">
    <link href="https://cdn.datatables.net/v/bs4/jszip-3.10.1/dt-2.1.8/af-2.7.0/b-3.2.0/b-colvis-3.2.0/b-html5-3.2.0/cr-2.0.4/fc-5.0.4/fh-4.0.1/kt-2.12.1/r-3.0.3/rr-1.5.0/sl-2.1.0/sr-1.4.1/datatables.min.css"
          rel="stylesheet">
{% endblock %}

{% block prepare_script %}
    <script>
        $(function () {
            // 更新导航栏
            $('#nav_data_set').addClass('active');
            // 定义sub字段
            window.$sub_input = $('input[name=row]');
            // 临时列表
            window.temp_sub_list = [];
            // 获取gtm数据地址
            window.get_gtm_data_url="{% url 'get_gtm_data' %}";
        });
    </script>
    <script src="{% static 'main/js/detail_data_set.js' %}"></script>
{% endblock %}

{% block script %}
    {#    <script src="{% static 'handsontable/handsontable.full.min.js' %}"></script>#}
    {##}
    {#    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>#}
    {#    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>#}
    <script src="https://cdn.datatables.net/v/bs4/jszip-3.10.1/dt-2.1.8/af-2.7.0/b-3.2.0/b-colvis-3.2.0/b-html5-3.2.0/cr-2.0.4/fc-5.0.4/fh-4.0.1/kt-2.12.1/r-3.0.3/rr-1.5.0/sl-2.1.0/sr-1.4.1/datatables.min.js"></script>


    <script>
        $(function () {
            {% if pk and pk != "add" %}
                // 获取变量
                {#getData("{% url 'data_set' pk %}", window.$csrf_input.val(), init_data_set);#}
            {% else %}

            {% endif %}
            

            // 注册添加行按钮
            bind_sub_add_row_button();
            // 注册添加列按钮
            bind_sub_add_col_button();
            // 悬浮批量复制按钮组
            var sub_button_group = $('#sub_button_group');
            {% if inside %}
                float_element(sub_button_group);
            {% else %}
                float_element(sub_button_group, 60);
            {% endif %}
            $('#mask').hide();
        });
        $(document).ready(function () {
            let data_set_str = $('#data_set_data').val();

            let data_set = {data: null};

            try {
                data_set = JSON.parse(data_set_str); // 转换字符串为 JSON 对象
            } catch (error) {
                console.error("Invalid JSON string:", error);
            }

            create_table_and_register_event(baseColumns, data_set.data);
        });
    </script>
{% endblock %}

{% block detail_header %}
    {% include 'main/include/detail_header.html' with object_name='数据组' %}
{% endblock %}

{% block detail_form %}
    <form method="post" id="object_form" novalidate onsubmit="return check_unsaved();">
        {% csrf_token %}
        {% include 'main/data_set/detail_form_content.html' %}
        {% include 'main/include/detail_redirect.html' %}
        {% include 'main/include/submit_button_group.html' with copy_url='data_set_copy' %}
    </form>
{% endblock %}

{% block detail_inner_list %}
    {% include 'main/data_set/detail_list_content.html' %}
{% endblock %}

{% block postpositive_script %}
    {{ block.super }}
{% endblock %}