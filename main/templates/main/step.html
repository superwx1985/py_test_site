<!DOCTYPE HTML>
{% load staticfiles %}
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        {% if form.initial %}
            <title>步骤详情 - {{ form.initial.name }}</title>
        {% else %}
            <title>步骤详情 - 添加</title>
        {% endif %}
        <link rel="stylesheet" href='{% static "main/js/jquery-ui-1.12.1.custom/jquery-ui.min.css" %}'>
        <link rel="stylesheet" href="{% static 'main/css/bootstrap.min.css' %}">
        <link rel="stylesheet" href='{% static "main/css/jquery.dropdown.css" %}'>
        <link rel="stylesheet" href='{% static "main/css/main.css" %}'>
        <script src="{% static 'main/js/jquery-3.3.1.min.js' %}"></script>
        <script src="{% static 'main/js/jquery-ui-1.12.1.custom/jquery-ui.min.js' %}"></script>
        <script src="{% static 'main/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'main/js/jquery.dropdown.js' %}"></script>
        <script src="{% static 'main/js/main.js' %}"></script>
        <script src="{% static 'main/js/detail.js' %}"></script>
        <style type='text/css' media='screen'>
            textarea, input {
                width: 100%;
            }
            select {
                width: 300px;
            }
            div.row {
                padding: 5px 0px;
                min-height: 2em;
            }
        </style>
        <script>
            $(function () {
                // 触发展示Action相关内容
                showActionField($('#id_action'));
                // 注册Action变更
                $('#id_action').off('change').change(function () {
                    showActionField($(this));
                });
                // 触发操作提示
                {% if form.errors %}
                    show_info('请更正错误项', 'alert alert-warning', 2000)
                {% elif is_success is True %}
                    show_info('保存成功', 'alert alert-success', 2000)
                {% endif %}
            });
            // 展示Action相关内容
            function showActionField($actionSelect) {
                if ($actionSelect.find('option:selected').text().indexOf('UI') == 0) {
                    $('div[action_type="ui"]').show()
                    $('div[action_type="api"]').hide()
                    $('div[action_type="db"]').hide()
                } else if ($actionSelect.find('option:selected').text().indexOf('API') == 0) {
                    $('div[action_type="ui"]').hide()
                    $('div[action_type="api"]').show()
                    $('div[action_type="db"]').hide()
                } else if ($actionSelect.find('option:selected').text().indexOf('DB') == 0) {
                    $('div[action_type="ui"]').hide()
                    $('div[action_type="api"]').hide()
                    $('div[action_type="db"]').show()
                }
            }

            function debug(success, para, data) {
                console.log(success);
                console.log(para);
                console.log(data);
                window.ajax_data = data;
            }
        </script>
    </head>
    <body>
        <div class="container-fluid">
            {% if errors %}
                <ul>
                    {% for error in errors %}
                        <li style="color: red;">error: {{ error }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
            {% include 'main/show_info.html' %}
            <ol class="breadcrumb my-4">
                <li class="breadcrumb-item active">
                    该步骤目前被<abbr title="{% for o in related_objects %}【{{ o }}】{% if not forloop.last %}，{% endif %}{% endfor %}">{{ related_objects|length }}个</abbr>用例调用，创建时间：{{ obj.created_date }}，创建人：{{ obj.creator }}，上次修改时间：{{ obj.modified_date }}，修改人：{{ obj.modifier }}
                </li>
            </ol>

            <form action="" method="post" id="object_form" novalidate>
                {% csrf_token %}
                <div class="row">
                    <div class="col-1 text-right">名称</div>
                    <div class="col" form_data>
                        {{ form.name }}
                        {% if form.errors.name.0 %}
                            <div class="text-warning">{{ form.errors.name.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-1 text-right">描述</div>
                    <div class="col" form_data>
                        {{ form.description }}
                        {% if form.errors.description.0 %}
                            <div class="text-warning">{{ form.errors.description.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-1 text-right">关键字</div>
                    <div class="col" form_data>
                        {{ form.keyword }}
                        {% if form.errors.keyword.0 %}
                            <div class="text-warning">{{ form.errors.keyword.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-1 text-right">动作</div>
                    <div class="col" form_data>
                        {{ form.action }}
                        {% if form.errors.action.0 %}
                            <div class="text-warning">{{ form.errors.action.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-1 text-right">超时</div>
                    <div class="col" form_data>
                        {{ form.timeout }}
                        {% if form.errors.timeout.0 %}
                            <div class="text-warning">{{ form.errors.timeout.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-1 text-right">结果另存</div>
                    <div class="col mx-auto" form_data>
                        {{ form.save_as }}
                        {% if form.errors.save_as.0 %}
                            <div class="text-warning">{{ form.errors.save_as.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="ui">
                    <div class="col-1 text-right">定位方式</div>
                    <div class="col" form_data>
                        {{ form.ui_by }}
                        {% if form.errors.ui_by.0 %}
                            <div class="text-warning">{{ form.errors.ui_by.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="ui">
                    <div class="col-1 text-right">定位值</div>
                    <div class="col" form_data>
                        {{ form.ui_locator }}
                        {% if form.errors.ui_locator.0 %}
                            <div class="text-warning">{{ form.errors.ui_locator.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="ui">
                    <div class="col-1 text-right">索引</div>
                    <div class="col" form_data>
                        {{ form.ui_index }}
                        {% if form.errors.ui_index.0 %}
                            <div class="text-warning">{{ form.errors.ui_index.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="ui">
                    <div class="col-1 text-right">基元素</div>
                    <div class="col" form_data>
                        {{ form.ui_base_element }}
                        {% if form.errors.ui_base_element.0 %}
                            <div class="text-warning">{{ form.errors.ui_base_element.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="ui">
                    <div class="col-1 text-right">数据</div>
                    <div class="col" form_data>
                        {{ form.ui_data }}
                        {% if form.errors.ui_data.0 %}
                            <div class="text-warning">{{ form.errors.ui_data.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="ui">
                    <div class="col-1 text-right">特殊动作</div>
                    <div class="col" form_data>
                        {{ form.ui_special_action }}
                        {% if form.errors.ui_special_action.0 %}
                            <div class="text-warning">{{ form.errors.ui_special_action.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="ui">
                    <div class="col-1 text-right">浏览器弹出处理</div>
                    <div class="col" form_data>
                        {{ form.ui_alert_handle }}
                        {% if form.errors.ui_alert_handle.0 %}
                            <div class="text-warning">{{ form.errors.ui_alert_handle.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="api">
                    <div class="col-1 text-right">请求地址</div>
                    <div class="col" form_data>
                        {{ form.api_url }}
                        {% if form.errors.api_url.0 %}
                            <div class="text-warning">{{ form.errors.api_url.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="api">
                    <div class="col-1 text-right">请求 Headers</div>
                    <div class="col" form_data>
                        {{ form.api_headers }}
                        {% if form.errors.api_headers.0 %}
                            <div class="text-warning">{{ form.errors.api_headers.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="api">
                    <div class="col-1 text-right">请求 Body</div>
                    <div class="col" form_data>
                        {{ form.api_body }}
                        {% if form.errors.api_body.0 %}
                            <div class="text-warning">{{ form.errors.api_body.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <div class="row" action_type="api">
                    <div class="col-1 text-right">验证内容</div>
                    <div class="col" form_data>
                        {{ form.api_data }}
                        {% if form.errors.api_data.0 %}
                            <div class="text-warning">{{ form.errors.api_data.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                <br/>
    {#            <div>{{ form }}</div>#}
                <div class="save_button_group">
                    <table>
                        <tr>
                            <td><input type="submit" value="提交" class="btn btn-primary"></td>
                            <td><input type="reset" value="还原" class="btn btn-secondary"></td>
                            <td><input type="button" value="关闭" onclick="window.close();" class="btn btn-danger"></td>
                        </tr>
{#                        {% if is_success == True %}<tr><td colspan="3" class="text-success">保存成功</td></tr>{% endif %}#}
{#                        {% if form.errors %}<tr><td colspan="3" class="text-warning">请更正错误项</td></tr>{% endif %}#}
                    </table>
                </div>

            </form>

            <br/>
            <br/>
        </div>
    </body>
</html>