<!DOCTYPE HTML>
{% load staticfiles %}
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
        <title>TEST2</title>
        {% include 'main/include/general_css.html' %}
        {% include 'main/include/general_script.html' %}
        <style>

        </style>
        <script>
            $(function () {
                window.$csrf_input = $('input[name="csrfmiddlewaretoken"]');
                getList("{% url 'variable_group_select_json' %}", window.$csrf_input.val(), update_config_dropdown, "{selected_pk:1}");

                var roomName = 'aaa';

                var chatSocket = new WebSocket(
                    'ws://' + window.location.host +
                    '/ws/chat/' + roomName + '/');

                chatSocket.onmessage = function(e) {
                    var data = JSON.parse(e.data);
                    var message = data['message'];
                    document.querySelector('#chat-log').value += (message + '\n');
                };

                chatSocket.onclose = function(e) {
                    console.error('Chat socket closed unexpectedly');
                };

                document.querySelector('#chat-message-input').focus();
                document.querySelector('#chat-message-input').onkeyup = function(e) {
                    if (e.keyCode === 13) {  // enter, return
                        document.querySelector('#chat-message-submit').click();
                    }
                };

                document.querySelector('#chat-message-submit').onclick = function(e) {
                    var messageInputDom = document.querySelector('#chat-message-input');
                    var message = messageInputDom.value;
                    chatSocket.send(JSON.stringify({
                        'message': message
                    }));

                    messageInputDom.value = '';
                };

            });
            function update_config_dropdown(success, data) {
                var base_div = $("#div_base1");
                base_div.find("div#div_dropdown1").remove();
                var div_dropdown = $('<div id="div_dropdown1"><select id="select1" style="display:none" placeholder="请选择"></select></div>');
                base_div.append(div_dropdown);
                $("#div_dropdown1").j_dropdown({
                    data: data.data,
                    //multipleMode: 'label',
                    //limitCount: 1,
                    input: '<input type="text" maxLength="20" placeholder="请输入名称搜索">',
                    choice: function() {
                        console.log(this.selectId);
                        window._selectId1 = this.selectId;
                        //window._selectId = JSON.stringify(this.selectId);
                    }
                });
            }
        </script>
    </head>
    <body>
        {% csrf_token %}
        <div id="div_base1"></div>

        <br>
        <textarea id="chat-log" cols="100" rows="20" readonly></textarea><br/>
        <input id="chat-message-input" type="text" size="100"/><br/>
        <input id="chat-message-submit" type="button" value="Send"/>
    </body>
</html>