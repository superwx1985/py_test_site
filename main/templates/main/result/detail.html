{% extends 'main/detail_base.html' %}
{% load widget_tweaks %}
{% block title %}
    {{ form.initial.name }} - 结果 - {{ block.super }}
{% endblock %}
{% block style %}
    <style type='text/css' media='screen'>

    </style>
{% endblock %}
{% block script %}
    <script>
        $(function () {
            // 更新导航栏
            $('#nav_result').addClass('active');
            step_result_detail_popup();
            // 关闭遮罩
            $('#mask').hide();
        });
        // 步骤详情弹窗
        function step_result_detail_popup() {
            $('[name=step_result]').off('click').on('click', function() {
                var url = $(this).parents('tr').attr('step_result_url');
                var title = $(this).text();
                modal_with_iframe_max('step_result_modal', '', url);
            });
        }
    </script>
{% endblock %}

{% block detail_header %}
    {% include 'main/include/detail_header.html' with object_name='结果' %}
{% endblock %}

{% block detail_form %}
    <form method="post" id="object_form" novalidate>
        {% csrf_token %}
        <div class="row align-items-center">
            <div class="col-1 text-center font-weight-bold">名称</div>
            <div class="col" form_data>
                {% include 'main/include/form_input.html' with field=form.name %}
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-1 text-center font-weight-bold">描述</div>
            <div class="col" form_data>
                {% include 'main/include/form_textarea.html' with field=form.description rows='2' %}
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-1 text-center font-weight-bold">关键字</div>
            <div class="col" form_data>
                {% include 'main/include/form_input.html' with field=form.keyword %}
            </div>
        </div>
        <div class="row align-items-center" base>
            <div class="col-1 text-center font-weight-bold">项目</div>
            <div class="col" form_data>
                {% include 'main/include/form_input.html' with field=form.project %}
            </div>
        </div>

        {% include 'main/include/detail_redirect.html' %}
        {% include 'main/include/submit_button_group.html' %}
    </form>
    <div class="row align-items-center">
        <div class="col-1 text-center font-weight-bold">用例执行情况</div>
        <div class="col">
            {% if sub_objects %}
                <ul class="nav nav-tabs" role="tablist">
                    {% for case_result in sub_objects %}
                        <li class="nav-item">
                            <a class="nav-link {% if forloop.counter == 1 %}active{% endif %}" data-toggle="tab" href="#case_result_{{ case_result.pk }}">{% include 'main/include/status_icon.html' with status=case_result.result_status %}{{ forloop.counter }}.&nbsp;{{ case_result.name|truncatechars_html:10 }}</a>
                        </li>
                    {% endfor %}
                </ul>
                <div class="tab-content bg-light">
                    {% for case_result in sub_objects %}
                        <div id="case_result_{{ case_result.pk }}" class="tab-pane {% if forloop.counter == 1 %}active{% endif %}" style="padding: 1em">
                            <div>
                                {% include 'main/include/case_result_content.html' with case_result=case_result %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <span class="text-danger">未执行任何用例或结果入库失败</span>
            {% endif %}
        </div>
    </div>
{% endblock %}