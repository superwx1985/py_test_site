{% extends 'main/list_base.html' %}
{% block title %}用例 - {{ block.super }}{% endblock %}
{% block script %}
    <script>
        $(function () {
            // 更新导航栏
            $('#nav_case').addClass('active');
            // 获取添加地址
            window.addUrl="{% url 'case_add' %}";
            // 获取批量删除地址
            window.multiple_delete_url="{% url 'cases_multiple_delete' %}";
            // 获取批量复制地址
            window.multiple_copy_url="{% url 'cases_multiple_copy' %}";
            // 标识子对象
            {% if has_sub_object %}
                window.has_sub_object = true;
            {% endif %}
        })
    </script>
{% endblock %}
{% block result_table %}
    <div class="table-responsive" id='result_div'>
        <table class="table table-bordered table-hover result-table" id='result_table'>
            <colgroup>
                <col style='width: 60px;'>
                <col style='width: 60px;'>
                <col>
                <col style='width: 200px;'>
                <col style='width: 150px;'>
                <col style='width: 100px;'>
                <col style='width: 130px;'>
                <col style='width: 105px;'>
                <col style='width: 180px;'>
                <col style='width: 170px;'>
            </colgroup>
            <thead class="thead-light middle">
                <tr>
                    <th index data-toggle="tooltip" title="全选/全不选">序号</th>
                    <th order_by_text="pk">ID</th>
                    <th order_by_text="name">名称</th>
                    <th order_by_text="keyword">关键字</th>
                    <th order_by_text="project__name">项目</th>
                    <th order_by_text="m2m_count">步骤数</th>
                    <th order_by_text="reference_count">被调用次数</th>
                    <th order_by_text="real_name">作者</th>
                    <th order_by_text="modified_date">修改时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for obj in objects %}
                    <tr pk="{{ obj.pk }}" uuid="{{ obj.uuid }}" edit_url="{% url 'case' obj.pk %}" quick_update_url="{% url 'case_quick_update' obj.pk %}" del_url="{% url 'case_delete' obj.pk %}">
                        <td col_name='index' class="middle small"></td>
                        <td col_name='pk' class="middle small">{{ obj.pk }}</td>
                        <td col_name='name' class="align-middle">{{ obj.name }}</td>
                        <td col_name='keyword' class="middle">{{ obj.keyword }}</td>
                        <td col_name='project__name' class="middle">{{ obj.project__name }}</td>
                        <td col_name='m2m_count' class="middle">{{ obj.m2m_count }}</td>
                        <td col_name='reference_count' class="middle"><a href="javascript:show_reference('{% url "case_reference" obj.pk %}', '<span class=\'mark small\'>{{ obj.name }}</span>被调用情况')"><span class="font-weight-bold">{{ obj.reference_count }}</span></a></td>
                        <td col_name='real_name' class="middle">{{ obj.real_name }}</td>
                        <td col_name='modified_date' class="middle">{{ obj.modified_date }}</td>
                        <td class="middle">
                            <div>
                                {% if request.user.pk == obj.creator or is_admin %}
                                    <button type="button" name="edit_button" class="btn btn-info list_button" data-toggle="tooltip" title="查看及编辑"><i class="icon-edit"></i></button>
                                {% else %}
                                    <button type="button" name="edit_button" class="btn btn-info list_button" data-toggle="tooltip" title="查看"><i class="icon-list"></i></button>
                                {% endif %}
                                <button copy_url="{% url 'case_copy' obj.pk %}" type="button" name="copy_button" class="btn btn-warning list_button" data-toggle="tooltip" title="复制"><i class="icon-copy"></i></button>
                                <button type="button" name="delete_button" class="btn btn-danger list_button" data-toggle="tooltip" title="删除" {% if request.user.pk != obj.creator and not is_admin %}disabled="disabled"{% endif %}><i class="icon-trash"></i></button>
                            </div>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="10" class="text-center bg-secondary"><span class="text-white">无数据</span></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock %}