{% extends 'main/detail_base.html' %}
{% load staticfiles %}
{% block title %}
    {% if form.initial %}
        {{ form.initial.name }} - 变量组 - {{ block.super }}
    {% else %}
        新变量组 - {{ block.super }}
    {% endif %}
{% endblock %}

{% block style %}
    <style type='text/css' media='screen'>

    </style>
{% endblock %}

{% block prepare_script %}
    <script>
        $(function () {
            // 更新导航栏
            $('#nav_variable').addClass('active');
        });
    </script>
{% endblock %}

{% block script %}
    <script>
        $(function () {
            {% if temp_list_json %}
                // 获取暂存变量
                variable_update(true, $.parseJSON("{{ temp_list_json|escapejs }}"));
            {% else %}
                {% if pk %}
                    // 获取变量
                    getList("{% url 'variable_group_variables' pk %}", window.$csrf_input.val(), variable_update);
                {% else %}
                    // 初始化变量字段
                    update_variable_index_and_field(true);
                {% endif %}
            {% endif %}
            // 注册添加按钮
            $('#new_helper td[col_move]').on('click', function () {
                add_variable();
            });
            // 注册new helper的删除按钮事件
            $('#new_helper [col_del]').off('click').on('click', function () {
                $('#new_helper [col_name] input,#new_helper [col_value] input,#new_helper [col_description] input').val('').removeClass('is-invalid').siblings('div.invalid-feedback').remove();
            });
            // 启用排序功能
            sortable_variable();
        });
    </script>
    <script src="{% static 'main/js/detail_variable_group.js' %}"></script>
{% endblock %}

{% block detail_header %}
    {% include 'main/include/detail_header.html' with object_name='变量组' %}
{% endblock %}

{% block detail_form %}
    <form method="post" id="object_form" novalidate onsubmit="return check_unsaved();">
        {% csrf_token %}
        <div class="row align-items-center">
            <div class="col-1 text-center font-weight-bold">名称</div>
            <div class="col" form_data>
                {% include 'main/include/form_input.html' with field=form.name %}
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-1 text-center font-weight-bold">描述</div>
            <div class="col" form_data>
                {% include 'main/include/form_textarea.html' with field=form.description rows='2' %}
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-1 text-center font-weight-bold">关键字</div>
            <div class="col" form_data>
                {% include 'main/include/form_input.html' with field=form.keyword %}
            </div>
        </div>
        <div class="row align-items-center">
            <div class="col-1 text-center font-weight-bold">项目</div>
            <div class="col" form_data>
                {% include 'main/include/form_input.html' with field=form.project %}
            </div>
        </div>

        <input name="variable" hidden>
        {% include 'main/include/detail_redirect.html' %}
        {% include 'main/include/submit_button_group.html' with copy_url='variable_group_copy' %}
    </form>
{% endblock %}

{% block detail_inner_list %}
    <div class="row">
        <div class="col text-center">
            <h5 class="ui-widget-header">变量列表&nbsp;<i class="icon-question-sign" data-toggle="tooltip" title="变量的加载是有序的，先加载的变量可以被后加载的变量调用"></i></h5>
            <table id='variable_table' class="table table-sm table-bordered" style="width: 100%">
                <colgroup>
                    <col style='width: 60px;'>
                    <col style='width: 60px;'>
                    <col style='width: 60px;'>
                    <col style='width: 20%;'>
                    <col>
                    <col>
                </colgroup>
                <thead class="thead-light"><tr><th></th><th></th><th>顺序</th><th>名称</th><th>值</th><th>备注</th></tr></thead>
                <tbody class="text-left">
                    <tr id="new_helper" class="bg-light">
                        <td class="middle" col_move><i class="icon-ok-circle icon-2x text-success" data-toggle="tooltip" title="添加到变量组"></i></td>
                        <td class="middle" col_del><i class="icon-trash icon-2x" data-toggle="tooltip" title="删除"></i></td>
                        <td class="middle" col_index><span></span></td>
                        <td col_name><input placeholder="请输入变量名" class="form-control"></td>
                        <td col_value><input placeholder="请输入变量值" class="form-control"></td>
                        <td col_description><input placeholder="" class="form-control"></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}